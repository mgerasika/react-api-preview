{"ast":null,"code":"import { EventEmitter } from '../utils/event-emitter.util.js';\nimport { useRef, useEffect, useCallback } from 'react';\nfunction useMessage(_ref) {\n  let {\n    iframe\n  } = _ref;\n  const events = useRef({});\n  useEffect(() => {\n    window.onmessage = e => {\n      if (e.data) {\n        try {\n          const data = JSON.parse(e.data);\n          if (data.channel) {\n            events.current[data.channel].emit(data.data);\n          }\n          // eslint-disable-next-line no-empty\n        } catch {}\n      }\n    };\n  }, [iframe]);\n  return {\n    postToParent: useCallback((channel, data) => {\n      if (window.top) {\n        window.top?.postMessage(JSON.stringify({\n          channel,\n          data\n        }), '*');\n      }\n    }, []),\n    postToIframe: useCallback((channel, data) => {\n      iframe?.contentWindow?.postMessage(JSON.stringify({\n        channel,\n        data\n      }), '*');\n    }, [iframe?.contentWindow]),\n    subscribe: useCallback((channel, callback) => {\n      if (!events.current[channel]) {\n        events.current[channel] = new EventEmitter();\n      }\n      events.current[channel].subscribe(callback);\n      return () => events.current[channel].unsubscribe(callback);\n    }, [events])\n  };\n}\nexport { useMessage };","map":{"version":3,"sources":["../../../src/hooks/use-message.hook.ts"],"names":["useMessage","iframe","events","useRef","useEffect","window","onmessage","e","data","JSON","parse","channel","current","emit","postToParent","useCallback","top","postMessage","stringify","postToIframe","contentWindow","subscribe","callback","EventEmitter","unsubscribe"],"mappings":";;AAeO,SAASA,UAAU,OAAoC;EAAA,IAAhC;IAAEC;EAAe,CAAC;EAC5C,MAAMC,MAAM,GAAGC,MAAM,CAA+B,CAAA,CAAE,CAAC;EACvDC,SAAS,CAAC,MAAM;IACZC,MAAM,CAACC,SAAS,GAAIC,CAAC,IAAW;MAC5B,IAAIA,CAAC,CAACC,IAAI,EAAE;QACR,IAAI;UACA,MAAMA,IAAiB,GAAGC,IAAI,CAACC,KAAK,CAACH,CAAC,CAACC,IAAI,CAAC;UAC5C,IAAIA,IAAI,CAACG,OAAO,EAAE;YACdT,MAAM,CAACU,OAAO,CAACJ,IAAI,CAACG,OAAO,CAAC,CAACE,IAAI,CAACL,IAAI,CAACA,IAAI,CAAC;UAChD;UACA;SACH,CAAC,MAAM,CAAA;MACZ;KACH;EACL,CAAC,EAAE,CAACP,MAAM,CAAC,CAAC;EAEZ,OAAO;IACHa,YAAY,EAAEC,WAAW,CAAC,CAACJ,OAAe,EAAEH,IAAI,KAAK;MACjD,IAAIH,MAAM,CAACW,GAAG,EAAE;QACZX,MAAM,CAACW,GAAG,EAAEC,WAAW,CACnBR,IAAI,CAACS,SAAS,CAAC;UACXP,OAAO;UACPH;SACH,CAAgB,EACjB,GAAG,CACN;MACL;KACH,EAAE,EAAE,CAAC;IAENW,YAAY,EAAEJ,WAAW,CACrB,CAACJ,OAAe,EAAEH,IAAI,KAAK;MACvBP,MAAM,EAAEmB,aAAa,EAAEH,WAAW,CAC9BR,IAAI,CAACS,SAAS,CAAC;QACXP,OAAO;QACPH;OACH,CAAgB,EACjB,GAAG,CACN;IACL,CAAC,EACD,CAACP,MAAM,EAAEmB,aAAa,CAAC,CAC1B;IAEDC,SAAS,EAAEN,WAAW,CAClB,CAACJ,OAAe,EAAEW,QAA0B,KAAK;MAC7C,IAAI,CAACpB,MAAM,CAACU,OAAO,CAACD,OAAO,CAAC,EAAE;QAC1BT,MAAM,CAACU,OAAO,CAACD,OAAO,CAAC,GAAG,IAAIY,YAAY,EAAE;MAChD;MACArB,MAAM,CAACU,OAAO,CAACD,OAAO,CAAC,CAACU,SAAS,CAACC,QAAQ,CAAC;MAC3C,OAAO,MAAYpB,MAAM,CAACU,OAAO,CAACD,OAAO,CAAC,CAACa,WAAW,CAACF,QAAQ,CAAC;KACnE,EACD,CAACpB,MAAM,CAAC;GAEf;AACL","sourcesContent":["import { EventEmitter } from '@common/utils/event-emitter.util';\nimport { useCallback, useEffect, useRef } from 'react';\n\nexport interface IMessage<T> {\n    channel: string;\n    data: T;\n}\ninterface IProps {\n    iframe: HTMLIFrameElement | undefined;\n}\ninterface IReturn<T> {\n    postToParent: (name: string, data?: T) => void;\n    postToIframe: (name: string, data?: T) => void;\n    subscribe: (name: string, callback: (data: T) => void) => () => void;\n}\nexport function useMessage<T>({ iframe }: IProps): IReturn<T> {\n    const events = useRef<Record<string, EventEmitter>>({});\n    useEffect(() => {\n        window.onmessage = (e): void => {\n            if (e.data) {\n                try {\n                    const data: IMessage<T> = JSON.parse(e.data);\n                    if (data.channel) {\n                        events.current[data.channel].emit(data.data);\n                    }\n                    // eslint-disable-next-line no-empty\n                } catch {}\n            }\n        };\n    }, [iframe]);\n\n    return {\n        postToParent: useCallback((channel: string, data) => {\n            if (window.top) {\n                window.top?.postMessage(\n                    JSON.stringify({\n                        channel,\n                        data,\n                    } as IMessage<T>),\n                    '*',\n                );\n            }\n        }, []),\n\n        postToIframe: useCallback(\n            (channel: string, data) => {\n                iframe?.contentWindow?.postMessage(\n                    JSON.stringify({\n                        channel,\n                        data,\n                    } as IMessage<T>),\n                    '*',\n                );\n            },\n            [iframe?.contentWindow],\n        ),\n\n        subscribe: useCallback(\n            (channel: string, callback: (arg: T) => void) => {\n                if (!events.current[channel]) {\n                    events.current[channel] = new EventEmitter();\n                }\n                events.current[channel].subscribe(callback);\n                return (): void => events.current[channel].unsubscribe(callback);\n            },\n            [events],\n        ),\n    };\n}\n"]},"metadata":{},"sourceType":"module"}