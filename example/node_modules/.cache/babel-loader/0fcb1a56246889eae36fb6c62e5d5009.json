{"ast":null,"code":"import { __assign, __awaiter, __generator } from \"tslib\";\nimport { HttpRequest } from \"@aws-sdk/protocol-http\";\n/**\n * @internal\n */\nexport var useRegionalEndpointMiddleware = function (config) {\n  return function (next) {\n    return function (args) {\n      return __awaiter(void 0, void 0, void 0, function () {\n        var request, _a;\n        return __generator(this, function (_b) {\n          switch (_b.label) {\n            case 0:\n              request = args.request;\n              if (!HttpRequest.isInstance(request) || config.isCustomEndpoint) return [2 /*return*/, next(__assign({}, args))];\n              if (!(request.hostname === \"s3.amazonaws.com\")) return [3 /*break*/, 1];\n              request.hostname = \"s3.us-east-1.amazonaws.com\";\n              return [3 /*break*/, 3];\n            case 1:\n              _a = \"aws-global\";\n              return [4 /*yield*/, config.region()];\n            case 2:\n              if (_a === _b.sent()) {\n                request.hostname = \"s3.amazonaws.com\";\n              }\n              _b.label = 3;\n            case 3:\n              return [2 /*return*/, next(__assign({}, args))];\n          }\n        });\n      });\n    };\n  };\n};\n/**\n * @internal\n */\nexport var useRegionalEndpointMiddlewareOptions = {\n  step: \"build\",\n  tags: [\"USE_REGIONAL_ENDPOINT\", \"S3\"],\n  name: \"useRegionalEndpointMiddleware\",\n  override: true\n};\n/**\n * @internal\n */\nexport var getUseRegionalEndpointPlugin = function (config) {\n  return {\n    applyToStack: function (clientStack) {\n      clientStack.add(useRegionalEndpointMiddleware(config), useRegionalEndpointMiddlewareOptions);\n    }\n  };\n};","map":{"version":3,"sources":["../../src/use-regional-endpoint.ts"],"names":[],"mappings":";AAAA,SAAS,WAAW,QAAQ,wBAAwB;AAiBpD;;AAEG;AACH,OAAO,IAAM,6BAA6B,GAAG,UAAC,MAA0B,EAAA;EAAgC,OAAA,UAGtG,IAA+B,EAAA;IACD,OAAA,UAAO,IAAgC,EAAA;MAAA,OAAA,SAAA,CAAA,KAAA,CAAA,EAAA,KAAA,CAAA,EAAA,KAAA,CAAA,EAAA,YAAA;;;;;cAC7D,OAAO,GAAK,IAAI,CAAA,OAAT;cACf,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,OAAO,CAAC,IAAI,MAAM,CAAC,gBAAgB,EAAE,OAAA,CAAA,CAAA,CAAA,YAAO,IAAI,CAAA,QAAA,CAAA,CAAA,CAAA,EAAM,IAAI,CAAA,CAAG,CAAA;kBACrF,EAAA,OAAO,CAAC,QAAQ,KAAK,kBAAkB,CAAA,EAAvC,OAAA,CAAA,CAAA,CAAA,WAAA,CAAA,CAAA;cACF,OAAO,CAAC,QAAQ,GAAG,4BAA4B;;;cACtC,EAAA,GAAA,YAAY;cAAM,OAAA,CAAA,CAAA,CAAA,WAAM,MAAM,CAAC,MAAM,EAAE,CAAA;;cAA3C,IAAI,EAAA,KAAkB,EAAA,CAAA,IAAA,EAAsB,EAAE;gBACnD,OAAO,CAAC,QAAQ,GAAG,kBAAkB;cACtC;;;cACD,OAAA,CAAA,CAAA,CAAA,YAAO,IAAI,CAAA,QAAA,CAAA,CAAA,CAAA,EAAM,IAAI,CAAA,CAAG,CAAA;UAAC;;;KAC1B;EAT+B,CAS/B;AAbuG,CAavG;AAED;;AAEG;AACH,OAAO,IAAM,oCAAoC,GAAwB;EACvE,IAAI,EAAE,OAAO;EACb,IAAI,EAAE,CAAC,uBAAuB,EAAE,IAAI,CAAC;EACrC,IAAI,EAAE,+BAA+B;EACrC,QAAQ,EAAE;CACX;AAED;;AAEG;AACH,OAAO,IAAM,4BAA4B,GAAG,UAAC,MAA0B,EAAA;EAA0B,OAAC;IAChG,YAAY,EAAE,UAAC,WAAW,EAAA;MACxB,WAAW,CAAC,GAAG,CAAC,6BAA6B,CAAC,MAAM,CAAC,EAAE,oCAAoC,CAAC;IAC9F;GACD;AAJgG,CAI/F","sourcesContent":["import { HttpRequest } from \"@aws-sdk/protocol-http\";\nimport {\n  BuildHandler,\n  BuildHandlerArguments,\n  BuildHandlerOptions,\n  BuildHandlerOutput,\n  BuildMiddleware,\n  MetadataBearer,\n  Pluggable,\n  Provider,\n} from \"@aws-sdk/types\";\n\ntype PreviouslyResolved = {\n  region: Provider<string>;\n  isCustomEndpoint: boolean;\n};\n\n/**\n * @internal\n */\nexport const useRegionalEndpointMiddleware = (config: PreviouslyResolved): BuildMiddleware<any, any> => <\n  Output extends MetadataBearer\n>(\n  next: BuildHandler<any, Output>\n): BuildHandler<any, Output> => async (args: BuildHandlerArguments<any>): Promise<BuildHandlerOutput<Output>> => {\n  const { request } = args;\n  if (!HttpRequest.isInstance(request) || config.isCustomEndpoint) return next({ ...args });\n  if (request.hostname === \"s3.amazonaws.com\") {\n    request.hostname = \"s3.us-east-1.amazonaws.com\";\n  } else if (\"aws-global\" === (await config.region())) {\n    request.hostname = \"s3.amazonaws.com\";\n  }\n  return next({ ...args });\n};\n\n/**\n * @internal\n */\nexport const useRegionalEndpointMiddlewareOptions: BuildHandlerOptions = {\n  step: \"build\",\n  tags: [\"USE_REGIONAL_ENDPOINT\", \"S3\"],\n  name: \"useRegionalEndpointMiddleware\",\n  override: true,\n};\n\n/**\n * @internal\n */\nexport const getUseRegionalEndpointPlugin = (config: PreviouslyResolved): Pluggable<any, any> => ({\n  applyToStack: (clientStack) => {\n    clientStack.add(useRegionalEndpointMiddleware(config), useRegionalEndpointMiddlewareOptions);\n  },\n});\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}