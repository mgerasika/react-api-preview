{"ast":null,"code":"import { __assign, __awaiter, __generator } from \"tslib\";\n/**\n * This middleware modifies the input on S3 CreateBucket requests.  If the LocationConstraint has not been set, this\n * middleware will set a LocationConstraint to match the configured region.  The CreateBucketConfiguration will be\n * removed entirely on requests to the us-east-1 region.\n */\nexport function locationConstraintMiddleware(options) {\n  var _this = this;\n  return function (next) {\n    return function (args) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var CreateBucketConfiguration, region;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              CreateBucketConfiguration = args.input.CreateBucketConfiguration;\n              return [4 /*yield*/, options.region()];\n            case 1:\n              region = _a.sent();\n              if (!CreateBucketConfiguration || !CreateBucketConfiguration.LocationConstraint) {\n                args = __assign(__assign({}, args), {\n                  input: __assign(__assign({}, args.input), {\n                    CreateBucketConfiguration: region === \"us-east-1\" ? undefined : {\n                      LocationConstraint: region\n                    }\n                  })\n                });\n              }\n              return [2 /*return*/, next(args)];\n          }\n        });\n      });\n    };\n  };\n}\nexport var locationConstraintMiddlewareOptions = {\n  step: \"initialize\",\n  tags: [\"LOCATION_CONSTRAINT\", \"CREATE_BUCKET_CONFIGURATION\"],\n  name: \"locationConstraintMiddleware\",\n  override: true\n};\nexport var getLocationConstraintPlugin = function (config) {\n  return {\n    applyToStack: function (clientStack) {\n      clientStack.add(locationConstraintMiddleware(config), locationConstraintMiddlewareOptions);\n    }\n  };\n};","map":{"version":3,"sources":["../../src/index.ts"],"names":[],"mappings":";AAYA;;;;AAIG;AAEH,OAAM,SAAU,4BAA4B,CAC1C,OAAyC,EAAA;EAD3C,IAAA,KAAA,GAAA,IAAA;EAGE,OAAO,UACL,IAAoC,EAAA;IACD,OAAA,UACnC,IAAqC,EAAA;MAAA,OAAA,SAAA,CAAA,KAAA,EAAA,KAAA,CAAA,EAAA,KAAA,CAAA,EAAA,YAAA;;;;;cAE7B,yBAAyB,GAAK,IAAI,CAAC,KAAK,CAAA,yBAAf;cAElB,OAAA,CAAA,CAAA,CAAA,WAAM,OAAO,CAAC,MAAM,EAAE,CAAA;;cAA/B,MAAM,GAAG,EAAA,CAAA,IAAA,EAAsB;cACrC,IAAI,CAAC,yBAAyB,IAAI,CAAC,yBAAyB,CAAC,kBAAkB,EAAE;gBAC/E,IAAI,GAAA,QAAA,CAAA,QAAA,CAAA,CAAA,CAAA,EACC,IAAI,CAAA,EAAA;kBACP,KAAK,EAAA,QAAA,CAAA,QAAA,CAAA,CAAA,CAAA,EACA,IAAI,CAAC,KAAK,CAAA,EAAA;oBACb,yBAAyB,EAAE,MAAM,KAAK,WAAW,GAAG,SAAS,GAAG;sBAAE,kBAAkB,EAAE;oBAAM;kBAAE,CAAA;gBAAA,CAAA,CAEjG;cACF;cAED,OAAA,CAAA,CAAA,CAAA,YAAO,IAAI,CAAC,IAAI,CAAC,CAAA;UAAC;;;KACnB;EAjBoC,CAiBpC;AACH;AAEA,OAAO,IAAM,mCAAmC,GAA6B;EAC3E,IAAI,EAAE,YAAY;EAClB,IAAI,EAAE,CAAC,qBAAqB,EAAE,6BAA6B,CAAC;EAC5D,IAAI,EAAE,8BAA8B;EACpC,QAAQ,EAAE;CACX;AAED,OAAO,IAAM,2BAA2B,GAAG,UAAC,MAAwC,EAAA;EAA0B,OAAC;IAC7G,YAAY,EAAE,UAAC,WAAW,EAAA;MACxB,WAAW,CAAC,GAAG,CAAC,4BAA4B,CAAC,MAAM,CAAC,EAAE,mCAAmC,CAAC;IAC5F;GACD;AAJ6G,CAI5G","sourcesContent":["import {\n  InitializeHandler,\n  InitializeHandlerArguments,\n  InitializeHandlerOptions,\n  InitializeHandlerOutput,\n  InitializeMiddleware,\n  MetadataBearer,\n  Pluggable,\n} from \"@aws-sdk/types\";\n\nimport { LocationConstraintResolvedConfig } from \"./configuration\";\n\n/**\n * This middleware modifies the input on S3 CreateBucket requests.  If the LocationConstraint has not been set, this\n * middleware will set a LocationConstraint to match the configured region.  The CreateBucketConfiguration will be\n * removed entirely on requests to the us-east-1 region.\n */\n\nexport function locationConstraintMiddleware(\n  options: LocationConstraintResolvedConfig\n): InitializeMiddleware<any, any> {\n  return <Output extends MetadataBearer>(\n    next: InitializeHandler<any, Output>\n  ): InitializeHandler<any, Output> => async (\n    args: InitializeHandlerArguments<any>\n  ): Promise<InitializeHandlerOutput<Output>> => {\n    const { CreateBucketConfiguration } = args.input;\n    //After region config resolution, region is a Provider<string>\n    const region = await options.region();\n    if (!CreateBucketConfiguration || !CreateBucketConfiguration.LocationConstraint) {\n      args = {\n        ...args,\n        input: {\n          ...args.input,\n          CreateBucketConfiguration: region === \"us-east-1\" ? undefined : { LocationConstraint: region },\n        },\n      };\n    }\n\n    return next(args);\n  };\n}\n\nexport const locationConstraintMiddlewareOptions: InitializeHandlerOptions = {\n  step: \"initialize\",\n  tags: [\"LOCATION_CONSTRAINT\", \"CREATE_BUCKET_CONFIGURATION\"],\n  name: \"locationConstraintMiddleware\",\n  override: true,\n};\n\nexport const getLocationConstraintPlugin = (config: LocationConstraintResolvedConfig): Pluggable<any, any> => ({\n  applyToStack: (clientStack) => {\n    clientStack.add(locationConstraintMiddleware(config), locationConstraintMiddlewareOptions);\n  },\n});\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}