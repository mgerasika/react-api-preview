# Read first

Before start development, first run

```bash
yarn
yarn husky install
```

After installation check husky work correctly. Also install very helpful plugin for tailwindcss for VSCode
[tailwindcss-intellisense](https://github.com/tailwindlabs/tailwindcss-intellisense)

to start project in dev mode run

```bash
yarn storybook
```

# Amplify

In case if refresh token is not returned from AWS Cognito - try to change responseType from 'token' to 'code'. Also try to connect through app client without client secret

# Debug Info

In dev/stage env you can see additional debug info - to enable it just check IS_DEBUG localStorage flag ('true' or 'false')
(not available in production env)

# Production build

# Stack

-   [cra](https://reactjs.org/docs/create-a-new-react-app.html)
-   [twin.macro (tailwindcss + emotion preset)](https://github.com/ben-rogerson/twin.macro)
-   [emotion css](https://emotion.sh/docs/introduction)
-   [antd (ui)](https://ant.design/components/overview/)
-   [storybook (ui common preview)](https://storybook.js.org/)
-   [react-hook-form (for forms)](https://react-hook-form.com/)
-   [use-modal-hook (for modals)](https://www.npmjs.com/package/use-modal-hook)
-   [cypress (e2e)](https://docs.cypress.io/guides/overview/why-cypress)
-   [react-query (state managment))](https://react-query.tanstack.com/)
-   [i18n (localization)](https://react.i18next.com/)

## Project structure

### Naming rules:

-   Please use "dash" pattern for naming directories and components.
-   Put some util to utils folder and add .util suffix.
-   Put some constant to constants folder and add .constant suffix.
-   Put some enum to enums folder and add .enum suffix.
-   Put some interface to interfaces folder and add .interface suffix.
-   Put some services to services folder and add .service suffix.

```
  |__ src
	|__ general-ui
		|__ button
			|__ button.component.ts
	|__ hooks
	|__ utils

```

## Library publish/new version

First of all increase version in package.json version field.

After that if you want generating local package (zip) just simple run

```ts
yarn pub
```

if you need publish to npm - just run

```ts
yarn npm-pub
```

## Library usage

You can use oddbox-frontend-common over git-submodules or over npm package/zip package.
Currently oddbox-frontend & oddbox-frontend-admin for better development performance (about 30% quickly development than over npm-modules and npm-link) use git-modules.

If you want use npm-modules - then you need make some project configuration.
First of all you need update your package.json with new dependencies (list of actual dependencies you can find into package.json file into peerDependencies section).
Why so many dependencies? To awoid problem with three-shaking (big-bundle size) a lot off libraries moved to peerDependency section.

Also working example available [here](https://github.com/mgerasika/oddbox-frontend-common-npm-usage-example (todo move to oddbox github))

```ts
"dependencies": {
	...
	"@emotion/css": "^11.1.3",
	"@emotion/react": "^11.4.0",
	"@emotion/server": "^11.4.0",
	"@what3words/api": "^4.0.7",
	"react": "^17.0.2",
	"react-dom": "^17.0.2",
	"react-query": "3.33.7",
	"react-router": "^5.2.0",
	"react-router-dom": "^5.2.0",
	"react-scripts": "^4.0.3",
	"tailwindcss": "^2.2.4",
	"twin.macro": "^2.6.2"
	...
},
```

and also don't forget add oddbox-frontend-common library dependency

```ts
"dependencies": {
	...
	"oddbox-frontend-common": "^1.0.1",
	...
},
```

after that run

```ts
yarn
```

### Very important usage rule!!!

**Wrong:**

```ts
import {Button} from 'oddbox-frontent-common'; // if import in this case - got full library about 1mb - 2mb. Propousal - add eslint rule 'no-restricted-imports' to awoid this problem (need configure eslint).
```

**Right:**

```ts
import {Button} from 'oddbox-frontend-common/dist/general-ui/button/button.component';
```

## Coding & Naming Rules

### 1. Please use alias for imports, check update available aliases into tsconfig.json (note: If you want add new alias - you need update multiple configs: tsconfig, jest, storybook, cypress )

**Wrong:**

```ts
import {Button} from '../src/general-ui/button/button';
```

**Right:**

```ts
import {Button} from '@src/general-ui/button/button';
```

### 2. Interface and types should start with [I] symbol.

**Wrong:**

```ts
export interface User {
	firstName:string;
	lastName:string;
}

export type LoginRequest = {
	firstName:string;
	lastName:string;
}
```

**Right:**

```ts
export interface IUser {
	firstName:string;
	lastName:string;
}

export type ILoginRequest = {
	firstName:string;
	lastName:string;
}
```

### 3. Enum must starts with [E] symbol.

**Wrong:**

```ts
enum Color {
	red = 'red',
	blue = 'blue',
}
```

**Right:**

```ts
enum EColor {
	red = 'red',
	blue = 'blue',
}
```

### 3.1 Types must starts with [T] symbol.

**Wrong:**

```ts
type Color = 'red' | 'blue'
```

**Right:**

```ts
type TColor = 'red' | 'blue'
```

### 4. Component props should have [I(component-name)Props] suffix or [IProps].

**Wrong:**

```ts
interface ButtonProps { ... }

const Button = (props:ButtonProps) => { ... }
```

**Right:**

```ts
interface IButtonProps { ... }

const Button = (props:IButtonProps) => { ... }

//or better if no external export

interface IProps { ... }

const Button = (props:IProps) => { ... }
```

### 5. Event Handlers must have [handle] prefix and with name of event on the end.

**Wrong:**

```html
<button onClick="{sendForm}"></button>
```

**Right:**

```html
<button onClick="{handleButtonClick}" /> or <button onClick="{handleClick}" />
```

### 6. Avoid [export default] if possible (not critical).

**Wrong:**

```ts
export default MyComponent ...;
```

**Right:**

```ts
export const MyComponent ...;
```

### 7. Functions that return JSX shroud have [render] prefix.

**Wrong:**

```ts
const Button:React.FC = <IProps>(props) => {
	const getLabel = () => <div>{props.label}</div>
	...
};
```

**Right:**

```ts
const Button:React.FC = <IProps>(props) => {
	const renderLabel = () => <div>{props.label}</div>
	...
};
```

### 8. Deconstruct arguments into top of component.

**Wrong:**

```ts
const Input = (props: IProps) => {
	...
};
```

**Right:**

```ts
const Input = ({label, className} : IProps) => {
    ...
};

or

const Input = (props: IProps) => {
	const {label, className, ...rest} = props;
	...
};
```

### 9. Use css attribute only with external style object or use tw attribute if possible without external usage. Always put styles object after component body.

**Wrong:**

```ts
const Button = ({...}:IProps): JSX.Element => {
	return <div css={{color:red}} />;
};
```

**Right:**

```ts
const Button = ({...}:IProps): JSX.Element => {
	return <div css={styles.button} />;
};

const styles =  {
	button: css`color:red;`,
};
```

### 10. Try use tw attribute for styling much as possible (but avoid tw and css together)

**Wrong:**

```ts
const Button = ({...}:IButtonProps): JSX.Element => {
	return <div css={styles.root} tw="m-2" />
};

const styles = {
    root: css`padding:8px;`,
};
```

**Right:**

```ts
const Button = ({...}:IButtonProps): JSX.Element => {
	...<div tw="p-2 m-2" />
};
```

### 11. If function has closure - add correctly name ( like create...Handler or onCreate...Handler)

**Wrong:**

```ts
const handleSort = (name) => (ev) => {...}

<div onClick={handleSort('firstName')}>...</>
<div onClick={handleSort('lastName')}>...</>
```

**Right:**

```ts
const createSortHandler = (name) => (ev) => {...}

<div onClick={createSortHandler('firstName')}>...</>
<div onClick={createSortHandler('lastName')}>...</>
```

### 12. Avoid 'Component' suffix or 'Comp' into Component names

**Wrong:**

```ts
export const ButtonComponent : (props:IProps) {...}
export const ButtonComp : (props:IButtonProps) {...}
```

**Right:**

```ts
export const Button : (props:IProps) {...}
```

### 13. Prefer write e2e tests with cypress instead integration or unit (sometimes combine but on 1 place e2e).

### 14. Try use lazy routes much as possible (and use ROUTES config for it)

### 15. Why git-submodules not monorepo or npm packages ...

    - more quickest way into development process
    - no problem with vscode performance + intellisense (monorepo - already tried into start of project - only webstorm no vscode )
    - no problem with tree-shaking + npm-link & unlink (dev mode only) (npm packages, more slow development process)
    - but have problem with library dependency (each project should have list of libraries)- but it once only during setup

### 16. Add your own ideas ...

## Some techniques that need explanation/external documentation.

-   No shared css (use react components for it, for example don't use native link with className <a className="link">
    instead create own component and add to storybook <Link />, example with helper text or required)
-   Tailwind css config for custom styles
-   Swagger code generation.
-   Links with makeLinks (typed links strings).
-   FormField (auto field with external configs for validation and configuration).
-   Localization with i18n (get strings automatically)

## Localization

Look into example for developers for quickly find strings (https://monosnap.com/file/prZVuKAMvwLubZbCg4z2wr5UpqkiAs)

```ts
 - TRANSLATION_PREFIX // set to '#' for example into browser localStorage
 - CURRENT_LOCATE_TRANSLATION_PREFIX // set to '$' symbol for example into browser localStorage
```

## Common errors

### 1. Component is changing an uncontrolled input to be controlled. This is likely caused by the value changing from undefined to a defined value, which should not happen. Decide between using a controlled or uncontrolled input element for the lifetime of the component. [more info](https://reactjs.org/link/controlled-components)

```html
- check undefined for default values into form components:
```

**Wrong:**

```ts
const form = useForm<IFormProps>();
```

**Right:**

```ts
const form = useForm<IFormProps>({email:''});
```

### 2. Code generation fails with can't transpile interface error

```html
- use custom babel.config for babel-node-ts (for create-react-app)
```

### 3. Property 'css' does not exist on type

```html
- update "types": ["@emotion/core", "jest", "node"] into tsconfig
```

### 4. Module not found: Error: Can't resolve 'fs' in '/Volumes/ssd-500/git/ciklum/oddbox/oddbox-frontend-monorepo/node_modules/twin.macro'

```html
- delete .next folder and try again.
```

### 5. Critical dependency: Critical dependency: require function is used in a way in which dependencies cannot be statically extracted

```html
use rolup for build https://github.com/ben-rogerson/twin.macro/issues/326
```
